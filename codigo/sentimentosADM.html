<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bella Vida | Sentimentos</title>
    <link rel="stylesheet" href="styles/header.css">
    <link rel="stylesheet" href="styles/sentimentos.css">

</head>

<body>

    <header>
        <div class="container">
            <a class="logo" href="./index.html">Bella Vida</a>
            <ul class="navbar">
                <a href="sentimentosADM.html">Sentimentos</a>
                <a href="sentimentosADM.html">
                    <img src="img/cerebro.jpeg" alt="sentimentos">
                </a>
                <a id="emocao" href="emocao.html">Emoção</a>
                <a href="emocao.html">
                    <img src="img/coracao.jpeg" alt="emocao">
                </a>
                <a id="login" href="login.html">Login</a>
                <a href="login.html">
                    <img src="icone/login1.jpg" id="login">
                </a>
            </ul>
        </div>
    </header>

    <div id="card" class="cards"> 
        <div class="card-principal">
            <div class="imagem-interna">   
                <img class="imagem" src="" alt="">
            </div>
            <div class="texto">
                <h1> <input type="text" id="titulo_input" placeholder="  Titulo"> </h1>
                <p class="mensagens">
                    <input type="text" id="texto_input" placeholder="Escreva seu texto">
                   </p>
                   <button onclick="publicar()">  Publicar </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Função para listar todos os posts
        function listarPosts() {
            fetch('/api/posts')
                .then(response => response.json())
                .then(posts => {
                    const cardContainer = document.getElementById('card');
                    cardContainer.innerHTML = ''; // Limpa os posts anteriores

                    posts.forEach(post => {
                        cardContainer.innerHTML += `
                            <div class="cards">
                                <div class="card-principal">
                                    <div class="imagem-interna">   
                                        <img class="imagem" src="img/eu.jpeg" alt="Imagem do post">
                                    </div>
                                    <div class="texto">
                                        <h1>${post.titulo}</h1>
                                        <p class="mensagens">${post.texto}</p>
                                        <button onclick="deletarPost(${post.id})">Excluir</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                })
                .catch(error => {
                    console.error('Erro ao listar posts:', error);
                    alert('Erro ao tentar carregar os posts!');
                });
        }

        // Função para publicar um post
        function publicar() {
            const titulo = document.getElementById('titulo_input').value;
            const texto = document.getElementById('texto_input').value;

            if (texto === '' || titulo === '') {
                alert('Preencha todos os campos!');
                return;
            }

            // Enviar dados para a API via POST
            fetch('/api/posts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ titulo, texto })
            })
                .then(response => {
                    if (response.ok) {
                        alert('Post publicado com sucesso!');
                        listarPosts();  // Atualiza a lista de posts
                    } else {
                        alert('Erro ao publicar o post!');
                    }
                })
                .catch(error => {
                    console.error('Erro na requisição:', error);
                    alert('Erro ao tentar publicar o post!');
                });
        }

        // Função para deletar um post
        function deletarPost(postId) {
            fetch(`/api/posts/${postId}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        alert('Post excluído com sucesso!');
                        listarPosts();  // Atualiza a lista de posts após a exclusão
                    } else {
                        alert('Erro ao excluir o post!');
                    }
                })
                .catch(error => {
                    console.error('Erro ao excluir o post:', error);
                    alert('Erro ao tentar excluir o post!');
                });
        }

        // Carregar os posts assim que a página for carregada
        document.addEventListener('DOMContentLoaded', function () {
            listarPosts();  // Chama a função para listar os posts ao carregar a página
        });
    </script>

</body>

</html>